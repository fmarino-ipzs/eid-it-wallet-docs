<!DOCTYPE html>

<html lang="it" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>7.2.1. Flusso Remoto &#8212; IT-Wallet Technical Documentation - Release 1.0 - 1.0.0</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/basic_mod.css?v=9b2032db" />
    <link rel="stylesheet" type="text/css" href="_static/itwallet-override.css?v=63798874" />
    <script src="_static/documentation_options.js?v=3fd72285"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=da26b4cc"></script>
    <script src="_static/js/theme.js"></script>
    <script src="_static/js/petite-vue.js"></script>
    <link rel="icon" href="https://avatars.githubusercontent.com/u/15377824?s=48&amp;v=4"/>
    <link rel="index" title="Indice" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="7.2.2. Flusso di Prossimità" href="proximity-flow.html" />
    <link rel="prev" title="7.2. Presentazione della Credenziale Digitale" href="credential-presentation.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="index.html" title="Go to homepage">IT-Wallet Technical Documentation - Release 1.0 - 1.0.0</a></h1>
            <a id="source_link" href="https://github.com/italia/eudi-wallet-it-docs">
    
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path fill="white" d="M 244.8,8 C 106.1,8 0,113.3 0,252 c 0,110.9 69.8,205.8 169.5,239.2 12.8,2.3 17.3,-5.6 17.3,-12.1 0,-6.2 -0.3,-40.4 -0.3,-61.4 0,0 -70,15 -84.7,-29.8 0,0 -11.4,-29.1 -27.8,-36.6 0,0 -22.9,-15.7 1.6,-15.4 0,0 24.9,2 38.6,25.8 21.9,38.6 58.6,27.5 72.9,20.9 2.3,-16 8.8,-27.1 16,-33.7 -55.9,-6.2 -112.3,-14.3 -112.3,-110.5 0,-27.5 7.6,-41.3 23.6,-58.9 -2.6,-6.5 -11.1,-33.3 2.6,-67.9 20.9,-6.5 69,27 69,27 20,-5.6 41.5,-8.5 62.8,-8.5 21.3,0 42.8,2.9 62.8,8.5 0,0 48.1,-33.6 69,-27 13.7,34.7 5.2,61.4 2.6,67.9 16,17.7 25.8,31.5 25.8,58.9 0,96.5 -58.9,104.2 -114.8,110.5 9.2,7.9 17,22.9 17,46.4 0,33.7 -0.3,75.4 -0.3,83.6 0,6.5 4.6,14.4 17.3,12.1 C 428.2,457.8 496,362.9 496,252 496,113.3 383.5,8 244.8,8 Z"/>
        </svg>
    
</a>
        

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Ricerca veloce</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Vai" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Indice dei Contenuti</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduzione</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">2. Principi di design</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture-overview.html">3. Panoramica dell'Architettura</a></li>
<li class="toctree-l1"><a class="reference internal" href="trust.html">4. L'Infrastruttura di Trust</a></li>
<li class="toctree-l1"><a class="reference internal" href="entities.html">5. Entità</a></li>
<li class="toctree-l1"><a class="reference internal" href="digital-credential-management.html">6. Gestione degli Attestati Elettronici</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="digital-credential-flows.html">7. Flussi relativi agli Attestati Elettronici</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="credential-issuance.html">7.1. Emissione di Attestati Elettronici</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="credential-presentation.html">7.2. Presentazione della Credenziale Digitale</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.2.1. Flusso Remoto</a></li>
<li class="toctree-l3"><a class="reference internal" href="proximity-flow.html">7.2.2. Flusso di Prossimità</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="endpoints.html">8. Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">9. Algoritmi Crittografici</a></li>
<li class="toctree-l1"><a class="reference internal" href="security-privacy-considerations.html">10. Considerazioni di Sicurezza e Privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-retention-policy.html">11. Politiche Generali di Conservazione dei Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="defined-terms-and-references.html">12. Termini Definiti e Riferimenti</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">13. Come contribuire</a></li>
<li class="toctree-l1"><a class="reference internal" href="open-source.html">14. Rilasci Open Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">15. Appendice</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="flusso-remoto">
<h1><span class="section-number">7.2.1. </span>Flusso Remoto<a class="headerlink" href="#flusso-remoto" title="Link to this heading">¶</a></h1>
<p>A seconda che l'Utente stia utilizzando un dispositivo mobile o una workstation, la Relying Party DEVE supportare i seguenti flussi remoti:</p>
<ul class="simple">
<li><p><strong>Stesso Dispositivo</strong>, la Relying Party DEVE fornire una posizione HTTP all'Istanza del Wallet utilizzando un reindirizzamento (302) o un href HTML in una pagina web;</p></li>
<li><p><strong>Dispositivo Diverso</strong>, la Relying Party DEVE fornire un Codice QR che l'Utente inquadra con l'Istanza del Wallet.</p></li>
</ul>
<p>Una volta che l'Istanza del Wallet stabilisce la fiducia con la Relying Party e valuta la richiesta, l'Utente fornisce il consenso per la divulgazione delle Credenziali Elettroniche, sotto forma di Presentazione Verificabile.</p>
<figure class="align-default" id="id1">
<span id="fig-high-level-flow-presentation"></span><p class="plantuml">
<object data="_images/plantuml-b8e883cffe4439f7bf69a8f049af6e83a737f375.svg" type="image/svg+xml" style="width:99%">
<a href="_images/plantuml-b8e883cffe4439f7bf69a8f049af6e83a737f375.png"><img src="_images/plantuml-b8e883cffe4439f7bf69a8f049af6e83a737f375.png" alt="La figura illustra il Flusso di Protocollo Remoto di Alto Livello." style="width: 99.0%"/></a>

</object></p>
<figcaption>
<p><span class="caption-number">Fig. 7.7 </span><span class="caption-text"><a class="reference external" href="https://www.plantuml.com/plantuml/svg/TL9TQ-em6BxFhtZmvXmBvvJpVV1YECHjmi2kKxmPIDU-sCoOP4bgSRz-YLNNAhjids_U3AtBZAis0dTyLUAUjYIGqaOvGcAKKxaIk16gPjhpUCvr9XrwYqm8SfX8BvSvzP1Pd55I4ZikLqZypzsUO3HZHkFR5Ue1Vdn755rNhbI6lsMEA-bZNokoBehmjOPfFfQLuNsuqgZArpDKS4EvWp9uI96hWc3pJE99EkLPX3Xkgdsnw9gFPQ4LbowE6Qj31wC7-1bA768nJoVj2hVZMOX9fe-pFaxkQUATsugsxsdShqjVgvMqr6mx8jFd5p-cprXzqFqEkiK4evBojVNa3-XFWEQM34R1I3gFjfRy3N3eUZQx6xpLIwVM92y7DQnF5eM0V_j9IRlQQUx_W7NktSbLEbJ9XDYXFfwmEImRaYpyuti7">Flusso di Protocollo Remoto di Alto Livello.</a></span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Una descrizione di alto livello del flusso remoto, dal punto di vista dell'Utente, è fornita di seguito e mostrata in <a class="reference internal" href="#fig-high-level-flow-presentation"><span class="std std-ref">Flusso di Protocollo Remoto di Alto Livello.</span></a>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><em>Richiesta di Autorizzazione</em>: l'Istanza del Wallet ottiene un URL nel flusso Stesso Dispositivo o un Codice QR contenente l'URL nel flusso Dispositivo Diverso dove l'oggetto di richiesta firmato è disponibile per il download.</p></li>
<li><p><em>Richiesta URI Request</em>: l'Istanza del Wallet estrae dal payload i seguenti parametri: <code class="docutils literal notranslate"><span class="pre">client_id</span></code>, <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code>.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Se <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code> è fornito e impostato con il valore <code class="docutils literal notranslate"><span class="pre">post</span></code>, l'Istanza del Wallet DOVREBBE trasmettere i suoi metadati all'endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> della Relying Party utilizzando il metodo HTTP POST.</p></li>
<li><p>Se <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code> è impostato con il valore <code class="docutils literal notranslate"><span class="pre">get</span></code> o non è presente, l'Istanza del Wallet DEVE recuperare l'Oggetto di Richiesta firmato utilizzando una richiesta HTTP con metodo GET all'endpoint fornito nel parametro <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><em>Risposta URI Request</em>: la Relying Party restituisce un Oggetto di Richiesta firmato all'Istanza del Wallet.</p></li>
<li><p><em>Controlli WI</em>: l'Istanza del Wallet:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>verifica la firma dell'Oggetto di Richiesta firmato utilizzando la chiave pubblica identificata nell'intestazione JWT dell'Oggetto di Richiesta. Utilizzando tale riferimento, l'Istanza del Wallet è in grado di selezionare la corretta chiave pubblica della Relying Party per la verifica della firma.</p></li>
<li><p>verifica che il <code class="docutils literal notranslate"><span class="pre">client_id</span></code> contenuto nell'emittente dell'Oggetto di Richiesta (Relying Party) corrisponda a quello ottenuto al passaggio numero 2 e al parametro <code class="docutils literal notranslate"><span class="pre">sub</span></code> contenuto nella Entity Configuration della Relying Party all'interno della Catena di Fiducia.</p></li>
<li><p>valuta le Credenziali Elettroniche richieste e verifica l'idoneità della Relying Party nel richiedere queste applicando le politiche relative a quella specifica Relying Party, ottenute con la Catena di Fiducia.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p><em>Consenso dell'Utente</em>: l'Istanza del Wallet chiede la divulgazione e il consenso dell'Utente mostrando l'identità della Relying Party e gli attributi richiesti.</p></li>
<li><p><em>Risposta di Autorizzazione POST</em>: l'Istanza del Wallet presenta le informazioni richieste alla Relying Party, insieme all'Attestato di Wallet se richiesto.</p></li>
<li><p><em>Controlli RP</em>: La Relying Party convalida le Credenziali presentate verificando la fiducia con i loro Fornitori di Credenziali e controlla l'Attestato di Wallet per garantire che il Fornitore di Wallet sia affidabile.</p></li>
<li><p><em>Risposta della Relying Party</em>: l'Istanza del Wallet informa l'Utente dell'autenticazione riuscita con la Relying Party, e l'Utente continua la navigazione.</p></li>
</ol>
</div></blockquote>
<p>Di seguito è riportato un diagramma di sequenza che dettaglia le interazioni tra tutte le parti coinvolte.</p>
<figure class="align-default" id="id2">
<p class="plantuml">
<object data="_images/plantuml-b931e68c808b3281e9d249889d04a2782c430087.svg" type="image/svg+xml" style="width:99%">
<a href="_images/plantuml-b931e68c808b3281e9d249889d04a2782c430087.png"><img src="_images/plantuml-b931e68c808b3281e9d249889d04a2782c430087.png" alt="La figura illustra il Flusso di Protocollo Remoto." style="width: 99.0%"/></a>

</object></p>
<figcaption>
<p><span class="caption-number">Fig. 7.8 </span><span class="caption-text"><a class="reference external" href="https://www.plantuml.com/plantuml/svg/fLPFRnkt4xtpKmpqE_ni87QJ7WsuYACwjXEtLYqbFjI5G7574kiLkIM7gwX5ldk7v6hDjHqWG0rVTfVptfitVwYtdgIZiAdXscwFhh756cvnOmbXuYnPPMjuNzkja86i2Pi5EY74cIBhOFJ9enk1z124MDWl-SN_FVoChLReH_2_QxrQqxiwe6YOHYlTI4CmkfDrZGHNXjcDmeIn7Hu937KaLsWeCqY1fW9cwQXkiTvfiu891-s-oJGyTcyERiu2hM5SQmO-JCZjamYMHC43ipLMT-mUUtR-aufqAmaXY017Fx6s4xZ31KpHnRp1o5Ql96bhYgDIL5W6oXZPuWcx_LT0JybkL8GLl_4sE8L2d9xoQ_IiDS71P2qzmkbfZnlLjxY76ZkCxoHuIjyast5l5ZQmThBmQ2aeQn_q2w4kYva7fy5b6UKfBbZ36aiasZNCmUWLHlcWdFMU7v8Jre6N6yoF6IZRjIRkk8OHOAkv7h_TZcsLZgyTBbaT9woDNW6j4OAhqwbxerBPvhfwLGfzbTDz1RyNB-SRfBMj_c3NIwz4PtmuWUdQRXD-9izgM06Jg8Vq8MbP129h1iMJZ_PlXLWv6nhsp_fzuuCrzKvi8y-MUPGqp05Cahf8nAR9dwwjaZN4eG4PcD6GLhbl-kZpMCJ8H2vuIZuaRRqLGiYQG2_XUVAWO-TsGPERwKm006ptnUI6QtM5q0qZnyXAaWIoYQ70wuSX0HH-fkU-FGgnwnwMK1aTqrIoaGjTQzBe1TOUlqFqnVaibiHOWYRFWKWP34SdqNczCbZj0S4k_epTk7Hsy-riKZLQxChnCiIp1dfMcS6AWL_sDafJGMEvcJJwFkWpEhtS9IP9mI7OPQ6-J-WcK_THijPLCPvyylFam1_c0-7HY6NiNskIKSCjbO76rYorss0rN4QzeR5986v8w_JVgHCPsZSH4UvDhadRpCa-eEd7hYasrDo7nKPx7tkujEtb7ibsQBceSRZd4a4VL1XGDDOP4Vfy_fZ5vSVoGDVVZeLh3t77xzr-Z_mwHV8thbCVLTn979Fwpc7BOghZGar7DNOCOqZB6gwy3-XW5cUqW-mbVxYRmNHVxmA5vIdqFazp3oM4OrO4swBZOtolNLrSpYvkpyz_5Iz7d0WuWl4QUMbTshhYi8-uWtVQLDoKIGh7SUByFx7UOoeE11-_WW18S4rOSAV20qVcwqARzBx8aIoqkNjJvIQvICSYqfz_8ITLTh_INjNMOmMIoEb58FH9XaeQzHBOw7ucDHD0dXU785kfwzWEnt4sanEYiEnJqpT1MfhxP0xoTGOXVQyEnNuhJ-K6zqivDI-pCQDAUw2O_ClPRFB3c-CtyEFhrt3paKlupwWyEeet5ZM-lul0TMCnLxP2-DfDecIDFWaSCfLt1oVsygNXdicrWRvJSJdFs-7Awcuyp_x11pPugfnkA5VZvCczaqOwZVf19EXNOKevctpuc8n7uREW8F-pXry5oowXir637qePR7z1DVqFflwNod3bzD8cpqyEB_GdZhrbwh2f_mK0">Flusso di Protocollo Remoto.</a></span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>I dettagli di ogni passaggio mostrato nell'immagine precedente sono descritti di seguito.</p>
<p><strong>Passaggi 1-2</strong>: L'Utente richiede di accedere a una risorsa protetta della Relying Party.</p>
<p><strong>Passaggi 3-5</strong>: La Relying Party crea un valore di stato legato all'user-agent (ad esempio, utilizzando un cookie HTTP sicuro), l'Oggetto di Richiesta disponibile per il download nella posizione <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>. Quindi ispeziona l'user-agent per determinare se il flusso avviene sullo stesso dispositivo dell'user-agent.</p>
<p><strong>Passaggi 6-9 (Richiesta di Autorizzazione)</strong>: La Relying Party fornisce all'user-agent una pagina JavaScript che ispeziona l'endpoint di stato e all'Istanza del Wallet un URL contenente la Richiesta di Autorizzazione.</p>
<blockquote>
<div><p>Nel <strong>Flusso Dispositivo Diverso</strong>, l'URI di Richiesta viene presentato come un Codice QR mostrato all'Utente. L'Utente scansiona il Codice QR utilizzando l'Istanza del Wallet e recupera un URL con i parametri <code class="docutils literal notranslate"><span class="pre">client_id</span></code>, <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code> e <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code>.</p>
<p>Di seguito è rappresentato un esempio non normativo di un Codice QR emesso dalla Relying Party.</p>
</div></blockquote>
<figure class="align-center" style="width: 50%">
<img alt="_images/verifier_qr_code.svg" src="_images/verifier_qr_code.svg" />
</figure>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>https://wallet-solution.example.org/authorization?client_id=https%3A%2F%2Frelying-party.example.org&amp;request_uri=https%3A%2F%2Frelying-party.example.org&amp;request_uri_method=post
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Il <em>livello di correzione degli errori</em> scelto per il Codice QR DEVE essere Q (Quartile - fino al 25%), poiché offre un buon equilibrio tra capacità di correzione degli errori e densità/spazio dei dati. Questo livello di qualità e correzione degli errori consente al Codice QR di rimanere leggibile anche se è danneggiato o parzialmente oscurato.</p>
</div>
<p>Al contrario, nel <strong>Flusso Stesso Dispositivo</strong>, la Relying Party utilizza un reindirizzamento di risposta HTTP (con codice di stato impostato a 302) o una pagina html con un pulsante href, contenente l'URL che fornisce le stesse informazioni del Flusso Dispositivo Diverso. Di seguito è riportato un esempio non normativo:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://wallet-solution.digital-strategy.europa.eu?client_id=https%3A%2F%2Frelying-party.example.org%2Fcb&amp;request_uri=https%3A%2F%2Frelying-party.example.org%2Frequest_uri&amp;request_uri_method=post</span>
</pre></div>
</div>
<p><strong>Passaggio 10</strong>: L'Istanza del Wallet valuta la fiducia con la Relying Party.</p>
<p><strong>Passaggi 11-13 (Richiesta URI Request)</strong>: L'Istanza del Wallet verifica se la Relying Party ha fornito il <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code> all'interno del suo Oggetto di Richiesta firmato.</p>
<blockquote>
<div><ul>
<li><p>Se è fornito ed è uguale a <code class="docutils literal notranslate"><span class="pre">post</span></code>, l'Istanza del Wallet DOVREBBE fornire i suoi metadati alla Relying Party. La Relying Party aggiorna l'Oggetto di Richiesta in base alle capacità tecniche del Wallet.</p>
<p>Di seguito è riportato un esempio non normativo di una richiesta HTTP effettuata dall'Istanza del Wallet alla Relying Party.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/request</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">client.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/oauth-authz-req+jwt</span>

<span class="nt">wallet_metadata</span><span class="o">=</span><span class="s">%7B%22authorization_endpoint%22%3A%20%22eudiw%3A%22%2C%20%22response_types_supported%22%3A%20%5B%22vp_token%22%5D%2C%20%22response_modes_supported%22%3A%20%5B%22form_post.jwt%22%5D%2C%20%22vp_formats_supported%22%3A%20%7B%22dc%2Bsd-jwt%22%3A%20%7B%22sd-jwt_alg_values%22%3A%20%5B%22ES256%22%2C%20%22ES384%22%5D%7D%7D%2C%20%22request_object_signing_alg_values_supported%22%3A%20%5B%22ES256%22%5D%7D%2C</span><span class="p">&amp;</span><span class="nt">wallet_nonce</span><span class="o">=</span><span class="s">%22qPmxiNFCR3QTm19POc8u%22</span>
</pre></div>
</div>
<p>Dove il corpo della richiesta prima di essere codificato in <cite>application/x-www-form-urlencoded</cite> dal Wallet corrisponde a:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;wallet_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;authorization_endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://wallet-solution.digital-strategy.europa.eu/authorization&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;response_types_supported&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;vp_token&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;response_modes_supported&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;form_post.jwt&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;vp_formats_supported&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;dc+sd-jwt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;sd-jwt_alg_values&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;ES256&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;ES384&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;request_object_signing_alg_values_supported&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;ES256&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;client_id_schemes_supported&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;wallet_nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;qPmxiNFCR3QTm19POc8u&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Quando la scoperta delle capacità dell'Istanza del Wallet non è supportata dalla Relying Party, l'Istanza del Wallet richiede l'Oggetto di Richiesta firmato utilizzando il metodo HTTP GET.</p></li>
</ul>
</div></blockquote>
<p><strong>Passaggio 14 (Risposta URI Request)</strong>: La Relying Party emette l'Oggetto di Richiesta firmandolo utilizzando una delle sue chiavi private crittografiche, le cui parti pubbliche sono state pubblicate all'interno della sua Entity Configuration (<cite>metadata.openid_credential_verifier.jwks</cite>). L'Istanza del Wallet ottiene l'Oggetto di Richiesta firmato.</p>
<blockquote>
<div><p>Di seguito è riportato un esempio non normativo della Risposta URI di Reindirizzamento:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/oauth-authz-req+jwt</span>

eyJhbGciOiJFUzI1NiIs...9t2LQ
</pre></div>
</div>
<p>Un esempio non normativo di un Oggetto di Richiesta sotto forma di intestazione e payload decodificati è mostrato di seguito:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES256&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;oauth-authz-req+jwt&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9tjiCaivhWLVUJ3AxwGGz_9&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;trust_chain&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;MIICajCCAdOgAwIBAgIC...awz&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;MIICajCCAdOgAwIBAgIC...2w3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;MIICajCCAdOgAwIBAgIC...sf2&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://relying-party.example.org&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;response_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;direct_post.jwt&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;response_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vp_token&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;dcql_query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;credentials&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;personal id data&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dc+sd-jwt&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;vct_values&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;https://trust-registry.eid-wallet.example.it/credentials/v1.0/personidentificationdata&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;claims&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;given_name&quot;</span><span class="p">]},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;family_name&quot;</span><span class="p">]},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;personal_administrative_number&quot;</span><span class="p">]}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wallet attestation&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dc+sd-jwt&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;vct_values&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://itwallet.registry.example.it/WalletAttestation&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;claims&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;wallet_link&quot;</span><span class="p">]},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;wallet_name&quot;</span><span class="p">]}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;response_uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://relying-party.example.org/response_uri&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2c128e4d-fc91-4cd3-86b8-18bdea0988cb&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;wallet_nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;qPmxiNFCR3QTm19POc8u&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3be39b69-6ac1-41aa-921b-3e6c07ddcb03&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://relying-party.example.org&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1672418465</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1672422065</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request_uri_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;post&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Passaggi 15-17 (Controlli WI)</strong>: L'Istanza del Wallet verifica l'Oggetto di Richiesta, che è sotto forma di JWT firmato. Quindi elabora i metadati della Relying Party e applica le politiche pertinenti per determinare quali Credenziali Elettroniche e dati dell'Utente la Relying Party è autorizzata a richiedere.</p>
<p><strong>Passaggi 18-19 (Consenso dell'Utente)</strong>: L'Istanza del Wallet richiede il consenso dell'Utente per divulgare le Credenziali richieste mostrando l'identità della Relying Party e gli attributi richiesti. L'Utente autorizza e acconsente alla presentazione delle Credenziali selezionando/deselezionando i dati personali da rilasciare.</p>
<p><strong>Passaggio 20 (Risposta di Autorizzazione)</strong>: L'Istanza del Wallet fornisce la Risposta di Autorizzazione alla Relying Party utilizzando una richiesta HTTP con il metodo POST (modalità di risposta &quot;direct_post.jwt&quot;).</p>
<blockquote>
<div><p>Di seguito è riportato un esempio non normativo della Risposta di Autorizzazione:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/response_uri</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">HOST</span><span class="o">:</span> <span class="l">relying-party.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

<span class="nt">response</span><span class="o">=</span><span class="s">eyJhbGciOiJFUzI1NiIs...9t2LQ</span>
</pre></div>
</div>
<p>Di seguito è riportato un esempio non normativo del payload decifrato del JWT contenuto nel parametro <code class="docutils literal notranslate"><span class="pre">response</span></code>, prima della codifica base64url. Il valore del parametro <code class="docutils literal notranslate"><span class="pre">vp_token</span></code> corrisponde al formato utilizzato quando il linguaggio di query DCQL viene utilizzato nella richiesta di presentazione.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3be39b69-6ac1-41aa-921b-3e6c07ddcb03&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;vp_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;personal id data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJFUzI1NiIs...PT0iXX0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;wallet attestation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJFUzI1NiIs...NTi0XG&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Passaggi 21-25 (Controlli RP)</strong>: La Relying Party verifica la Risposta di Autorizzazione, estrae l'Attestato di Wallet per stabilire la fiducia con la Soluzione Wallet. Quindi estrae le Credenziali Elettroniche e attesta la fiducia con il Fornitore di Credenziale e la prova di possesso dell'Istanza del Wallet delle Credenziali Elettroniche presentate. Infine, la Relying Party verifica lo stato di revoca delle Credenziali Elettroniche presentate come descritto in <a class="reference internal" href="credential-revocation.html#revoca-e-sospensione-degli-attestati-elettronici"><span class="std std-ref">Revoca e Sospensione degli Attestati Elettronici</span></a>. Se tutte le verifiche precedenti hanno dato esito positivo, la Relying Party aggiorna la sessione dell'Utente.</p>
<p><strong>Passaggi 26-27 o 28 (Risposta della Relying Party)</strong>: La Relying Party fornisce all'Istanza del Wallet la risposta sulla presentazione, che informa l'Utente.</p>
<blockquote>
<div><p>Dopo aver ricevuto e convalidato la Risposta di Autorizzazione all'Endpoint di Risposta, la Relying Party restituisce all'Istanza del Wallet un HTTP 200 OK. In particolare, nel Flusso Stesso Dispositivo, la Relying Party DOVREBBE anche passare il <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> all'Istanza del Wallet. Dopo aver ricevuto il <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>, l'Istanza del Wallet DEVE eseguire un reindirizzamento all'URL specificato dal <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>. Questo reindirizzamento consente alla Relying Party di riprendere senza problemi l'interazione con l'Utente sul dispositivo che ha avviato il flusso. Quando la risposta non contiene il parametro <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>, l'Istanza del Wallet non è tenuta a eseguire ulteriori passaggi. L'Utente dovrebbe chiudere manualmente l'Istanza del Wallet e aprire l'user-agent per continuare il flusso.</p>
<p>Di seguito è riportato un esempio non normativo della risposta nel Flusso Stesso Dispositivo.</p>
</div></blockquote>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;redirect_uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://relying-party.example.org/cb?response_code=091535f699ea575c7937fa5f0f454aee&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Passaggi 29-30</strong>: La pagina JavaScript sta ispezionando l'endpoint di stato.</p>
<blockquote>
<div><p>Di seguito è riportato un esempio non normativo della Richiesta HTTP all'endpoint di stato, dove il parametro <code class="docutils literal notranslate"><span class="pre">id</span></code> contiene un valore opaco e casuale:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/session-state?id=3be39b69-6ac1-41aa-921b-3e6c07ddcb03</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">HOST</span><span class="o">:</span> <span class="l">relying-party.example.org</span>
</pre></div>
</div>
<p>Quando l'Istanza del Wallet ha fornito la presentazione all'endpoint <strong>response_uri</strong> della Relying Party e l'autenticazione dell'Utente ha avuto successo. La Relying Party aggiorna il cookie di sessione consentendo all'user-agent di accedere alla risorsa protetta. Viene fornito un URL di reindirizzamento che trasporta la posizione in cui l'user-agent deve navigare.
Di seguito è riportato un esempio non normativo della risposta con il <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> dalla Relying Party all'user-agent.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;redirect_uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://relying-party.example.org/cb?response_code=091535f699ea575c7937fa5f0f454aee&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Passaggi 31-32</strong>: L'user-agent viene reindirizzato all'URI di reindirizzamento per continuare la navigazione con la risorsa protetta resa disponibile all'Utente.</p>
<section id="richiesta-di-autorizzazione">
<h2><span class="section-number">7.2.1.1. </span>Richiesta di Autorizzazione<a class="headerlink" href="#richiesta-di-autorizzazione" title="Link to this heading">¶</a></h2>
<p>I parametri URL contenuti nella Richiesta di Autorizzazione della Relying Party, che includono il <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> dove l'Oggetto di Richiesta firmato può essere scaricato, sono descritti nella tabella seguente.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Nome</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>client_id</strong></p></td>
<td><p>OBBLIGATORIO. Identificatore univoco della Relying Party.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>request_uri</strong></p></td>
<td><p>OBBLIGATORIO. L'URL HTTP dove la Relying Party fornisce l'Oggetto di Richiesta firmato all'Istanza del Wallet.</p></td>
</tr>
<tr class="row-even"><td><p><strong>state</strong></p></td>
<td><p>RACCOMANDATO. Un identificatore univoco per la transazione corrente generato dalla Relying Party. Il valore DOVREBBE essere opaco per l'Istanza del Wallet.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>request_uri_method</strong></p></td>
<td><p>OPZIONALE. Il metodo HTTP DEVE essere impostato con <code class="docutils literal notranslate"><span class="pre">get</span></code> o <code class="docutils literal notranslate"><span class="pre">post</span></code>. L'Istanza del Wallet dovrebbe utilizzare questo metodo per ottenere l'Oggetto di Richiesta firmato dal <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>. Se non fornito o uguale a <code class="docutils literal notranslate"><span class="pre">get</span></code>, l'Istanza del Wallet DOVREBBE utilizzare il metodo HTTP <code class="docutils literal notranslate"><span class="pre">get</span></code>. Altrimenti, l'Istanza del Wallet DOVREBBE fornire i suoi metadati all'interno del corpo HTTP POST codificato in <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Avvertimento</p>
<p>Per motivi di sicurezza e per prevenire attacchi di tipo endpoint mix-up, il valore contenuto nel parametro <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> DEVE essere uno di quelli attestati da una terza parte fidata, come quelli forniti nei metadati <code class="docutils literal notranslate"><span class="pre">openid_credential_verifier</span></code> all'interno del parametro <code class="docutils literal notranslate"><span class="pre">request_uris</span></code>, ottenuti dalla Catena di Fiducia relativa alla Relying Party.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Il parametro <code class="docutils literal notranslate"><span class="pre">state</span></code> in una richiesta OAuth è opzionale, ma è altamente raccomandato. Viene utilizzato principalmente per prevenire attacchi Cross-Site Request Forgery (CSRF) includendo un valore unico e imprevedibile che la Relying Party può verificare al momento della ricezione della risposta. Inoltre, aiuta a mantenere lo stato tra la richiesta e la risposta, come le informazioni di sessione o altri dati di cui la Relying Party ha bisogno dopo il processo di autorizzazione.</p>
</div>
<p>Il valore corrispondente all'endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> DOVREBBE essere randomizzato, secondo <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc9101.html#section-5.2.1">RFC 9101, The OAuth 2.0 Authorization Framework: JWT-Secured Authorization Request (JAR)</a> Sezione 5.2.1.</p>
</section>
<section id="richiesta-uri-request">
<h2><span class="section-number">7.2.1.2. </span>Richiesta URI Request<a class="headerlink" href="#richiesta-uri-request" title="Link to this heading">¶</a></h2>
<p>La Relying Party DOVREBBE fornire il metodo POST con il suo endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> consentendo all'Istanza del Wallet di informare la Relying Party sulle sue capacità tecniche.</p>
<p>Questa funzionalità può essere utile quando, ad esempio, l'Istanza del Wallet supporta un insieme ristretto di funzionalità, algoritmi supportati o un URL specifico per il suo <code class="docutils literal notranslate"><span class="pre">authorization_endpoint</span></code>, e qualsiasi altra informazione che ritiene necessario fornire alla Relying Party per l'interoperabilità.</p>
<div class="admonition warning">
<p class="admonition-title">Avvertimento</p>
<p>L'Istanza del Wallet, quando fornisce le sue capacità tecniche alla
Relying Party, NON DEVE includere alcuna informazione dell'Utente o altre informazioni
esplicite riguardanti l'hardware utilizzato o le preferenze di utilizzo del suo Utente.</p>
</div>
<p>Se sia la Relying Party che l'Istanza del Wallet supportano il <code class="docutils literal notranslate"><span class="pre">request_uri_method</span></code> con HTTP POST, le capacità (metadati) dell'Istanza del Wallet DEVONO essere fornite utilizzando una richiesta HTTP all'endpoint <cite>request_uri</cite> della Relying Party, con il metodo POST e il tipo di contenuto impostato su <cite>application/x-www-form-urlencoded</cite>.
La richiesta e i suoi parametri sono definiti nella Sezione numero 5 (Richiesta di Autorizzazione) di <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>. Di seguito sono riportati i dettagli normativi e i riferimenti sui parametri da utilizzare dall'Istanza del Wallet nella richiesta.</p>
<table class="longtable docutils align-default" id="id3">
<caption><span class="caption-number">Tabella 7.1 </span><span class="caption-text">Parametri dell'Endpoint URI Request</span><a class="headerlink" href="#id3" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parametro</p></th>
<th class="head"><p>Descrizione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>wallet_metadata</cite></p></td>
<td><p>OPZIONALE. Oggetto JSON con parametri di metadati. Vedi <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>, Sezione 9.1 e la tabella seguente, &quot;Parametri dei Metadati del Wallet&quot;.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>wallet_nonce</cite></p></td>
<td><p>RACCOMANDATO. Stringa utilizzata dall'Istanza del Wallet per prevenire il replay delle risposte della Relying Party. Vedi <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>, Sezione 9.</p></td>
</tr>
</tbody>
</table>
<table class="longtable docutils align-default" id="id4">
<caption><span class="caption-number">Tabella 7.2 </span><span class="caption-text">Parametri dei Metadati del Wallet</span><a class="headerlink" href="#id4" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parametro</p></th>
<th class="head"><p>Descrizione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>vp_formats_supported</cite></p></td>
<td><p>OBBLIGATORIO. Oggetto con identificatori di formato delle Credenziali. Vedi <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a> Appendice B.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>alg_values_supported</cite></p></td>
<td><p>OPZIONALE. Array di suite crittografiche supportate. Vedi <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a> Appendice B.</p></td>
</tr>
<tr class="row-even"><td><p><cite>client_id_schemes_supported</cite></p></td>
<td><p>RACCOMANDATO. Array di schemi di Identificatore Client. Il valore predefinito è <cite>entity_id</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>authorization_endpoint</cite></p></td>
<td><p>URL dell'endpoint del server di autorizzazione, vedi <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc6749">OAUTH2</a>. L'utilizzo di un link universale è preferibile per una sicurezza migliorata e supporto di fallback, gli schemi url personalizzati possono anche essere utilizzati se necessario.</p></td>
</tr>
<tr class="row-even"><td><p><cite>response_types_supported</cite></p></td>
<td><p>OPZIONALE. Array JSON di valori &quot;response_type&quot; di OAuth 2.0. Se presente DEVE essere impostato su <cite>vp_token</cite>. Il valore predefinito è <cite>vp_token</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>response_modes_supported</cite></p></td>
<td><p>OPZIONALE. Array JSON di valori &quot;response_mode&quot; di OAuth 2.0. Vedi <a class="reference external" href="https://openid.net/specs/oauth-v2-jarm-final.html">JARM</a>.</p></td>
</tr>
<tr class="row-even"><td><p><cite>request_object_signing_alg_values_supported</cite></p></td>
<td><p>OPZIONALE. Vedi OpenID Connect Discovery.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Il parametro <code class="docutils literal notranslate"><span class="pre">wallet_nonce</span></code> è RACCOMANDATO per le Istanze del Wallet che vogliono prevenire la replica delle loro richieste http alle Relying Party.
Quando presente, la Relying Party DEVE valutarlo.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Per l'<code class="docutils literal notranslate"><span class="pre">authorization_endpoint</span></code> l'uso di link universali è preferito rispetto agli schemi url personalizzati perché, quando configurati correttamente utilizzando Assetlinks JSON per Android e Apple App Site Association per iOS, forniscono una sicurezza migliorata riducendo il rischio di dirottamento degli URL.
Inoltre, i link universali offrono meccanismi di fallback, consentendo al flusso di continuare senza problemi in un browser anche se l'Istanza del Wallet non è installata, garantendo un'esperienza Utente più fluida. Per garantire l'interoperabilità, il supporto degli schemi url personalizzati è anche RACCOMANDATO secondo il profilo di interoperabilità OpenID4VC High Assurance Interoperability Profile (HAIP) <a class="reference external" href="https://openid.net/specs/openid4vc-high-assurance-interoperability-profile-1_0-01.html">OPENID4VC-HAIP</a>, e in particolare utilizzando l'url personalizzato <code class="docutils literal notranslate"><span class="pre">haip://</span></code>.</p>
</div>
</section>
<section id="risposta-uri-request">
<h2><span class="section-number">7.2.1.3. </span>Risposta URI Request<a class="headerlink" href="#risposta-uri-request" title="Link to this heading">¶</a></h2>
<p>La Relying Party emette l'Oggetto di Richiesta firmato utilizzando il tipo di contenuto impostato su <code class="docutils literal notranslate"><span class="pre">application/oauth-authz-req+jwt</span></code>.</p>
<p>I parametri dell'intestazione JWT sono descritti di seguito:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Nome</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>alg</strong></p></td>
<td><p>Algoritmo utilizzato per firmare il JWT, secondo [<span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7516.html#section-4.1.1"><strong>RFC 7516#section-4.1.1</strong></a>]. DEVE essere uno degli algoritmi supportati nella Sezione <a class="reference internal" href="algorithms.html#algoritmi-crittografici"><span class="std std-ref">Algoritmi Crittografici</span></a> e NON DEVE essere impostato su <code class="docutils literal notranslate"><span class="pre">none</span></code> o su un identificatore di algoritmo simmetrico (MAC).</p></td>
</tr>
<tr class="row-odd"><td><p><strong>typ</strong></p></td>
<td><p>Tipo di Media del JWT, come definito in [<span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7519.html"><strong>RFC 7519</strong></a>] e [<span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9101.html"><strong>RFC 9101</strong></a>]. DOVREBBE essere impostato sul valore <code class="docutils literal notranslate"><span class="pre">oauth-authz-req+jwt</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><strong>kid</strong></p></td>
<td><p>ID della chiave della chiave pubblica necessaria per verificare la firma JWT, come definito in [<span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7517.html"><strong>RFC 7517</strong></a>]. OBBLIGATORIO quando viene utilizzato <code class="docutils literal notranslate"><span class="pre">trust_chain</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>trust_chain</strong></p></td>
<td><p>Sequenza di Entity Statement che compongono la Catena di Fiducia relativa alla Relying Party, come definito in <a class="reference external" href="https://openid.net/specs/openid-federation-1_0-41.html">OID-FED</a> Sezione 4.3 <em>Trust Chain Header Parameter</em>.</p></td>
</tr>
</tbody>
</table>
<p>I parametri del payload JWT sono descritti qui:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Nome</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>client_id</strong></p></td>
<td><p>Identificatore univoco della Relying Party.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>response_mode</strong></p></td>
<td><p>DEVE essere impostato su <code class="docutils literal notranslate"><span class="pre">direct_post.jwt</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><strong>dcql_query</strong></p></td>
<td><p>Oggetto che rappresenta una richiesta di presentazione di Credenziali, secondo il linguaggio di query DCQL definito nella Sezione 6 di <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>response_type</strong></p></td>
<td><p>DEVE essere impostato su <code class="docutils literal notranslate"><span class="pre">vp_token</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><strong>wallet_nonce</strong></p></td>
<td><p>Valore stringa utilizzato per mitigare gli attacchi di replay della risposta, come definito nella Sezione 5.11 (Request URI Method) di <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>. DEVE essere presente se precedentemente fornito dall'Istanza del Wallet.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>response_uri</strong></p></td>
<td><p>L'URI di Risposta a cui l'Istanza del Wallet DEVE inviare la Risposta di Autorizzazione utilizzando una richiesta HTTP con il metodo POST.</p></td>
</tr>
<tr class="row-even"><td><p><strong>nonce</strong></p></td>
<td><p>Numero crittograficamente casuale fresco con sufficiente entropia, la cui lunghezza DEVE essere di almeno 32 cifre.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>state</strong></p></td>
<td><p>Identificatore univoco della Richiesta di Autorizzazione.</p></td>
</tr>
<tr class="row-even"><td><p><strong>iss</strong></p></td>
<td><p>L'entità che ha emesso il JWT. Sarà popolato con l'id client della Relying Party.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>iat</strong></p></td>
<td><p>Timestamp Unix, che rappresenta l'ora in cui il JWT è stato emesso.</p></td>
</tr>
<tr class="row-even"><td><p><strong>exp</strong></p></td>
<td><p>Timestamp Unix, che rappresenta l'ora di scadenza in cui o dopo la quale il JWT NON DEVE più essere valido.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>request_uri_method</strong></p></td>
<td><p>Stringa che determina il metodo HTTP da utilizzare con l'endpoint <cite>request_uri</cite> per fornire i metadati dell'Istanza del Wallet alla Relying Party. Il valore non fa distinzione tra maiuscole e minuscole e può essere impostato su: <cite>get</cite> o <cite>post</cite>. Il metodo GET, come definito in [&#64;RFC9101], prevede che l'Istanza del Wallet invii una richiesta GET per recuperare un Oggetto di Richiesta. Il metodo POST prevede che l'Istanza del Wallet richieda la creazione di un nuovo Oggetto di Richiesta inviando una richiesta HTTP POST, con i suoi metadati, all'URI di richiesta della Relying Party.</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Avvertimento</p>
<p>Per motivi di sicurezza e per prevenire attacchi di tipo endpoint mix-up, il valore contenuto nel parametro <code class="docutils literal notranslate"><span class="pre">response_uri</span></code> DEVE essere uno di quelli attestati da una terza parte fidata, come quelli forniti nei metadati <code class="docutils literal notranslate"><span class="pre">openid_credential_verifier</span></code> all'interno del parametro <code class="docutils literal notranslate"><span class="pre">response_uris</span></code>, ottenuti dalla Catena di Fiducia relativa alla Relying Party.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>I seguenti parametri, anche se definiti in [OID4VP], non sono menzionati nel precedente esempio non normativo, poiché il loro utilizzo è condizionale e potrebbe cambiare in future versioni di questa documentazione.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">presentation_definition</span></code>: Oggetto JSON secondo <a class="reference external" href="https://identity.foundation/presentation-exchange/spec/v2.0.0/">Presentation Exchange</a>. Questo parametro NON DEVE essere presente quando <code class="docutils literal notranslate"><span class="pre">presentation_definition_uri</span></code> o <code class="docutils literal notranslate"><span class="pre">scope</span></code> sono presenti.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">presentation_definition_uri</span></code>: Non supportato. Stringa contenente un URL HTTPS che punta a una risorsa dove può essere recuperato un oggetto JSON Presentation Definition. Questo parametro DEVE essere presente quando il parametro <code class="docutils literal notranslate"><span class="pre">presentation_definition</span></code> o un valore <code class="docutils literal notranslate"><span class="pre">scope</span></code> che rappresenta una Presentation Definition non è presente.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">client_metadata</span></code>: Un oggetto JSON contenente i valori dei metadati della Relying Party. Se il parametro <code class="docutils literal notranslate"><span class="pre">client_metadata</span></code> è presente, l'Istanza del Wallet DEVE ignorarlo e considerare i metadati del client ottenuti attraverso la Catena di Fiducia OpenID Federation.</p></li>
</ul>
</div>
<section id="errori-dell-endpoint-uri-request">
<h3><span class="section-number">7.2.1.3.1. </span>Errori dell'Endpoint URI Request<a class="headerlink" href="#errori-dell-endpoint-uri-request" title="Link to this heading">¶</a></h3>
<p>Quando la Relying Party incontra errori durante l'emissione dell'Oggetto di Richiesta dall'endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>, DEVE restituire una risposta di errore con <code class="docutils literal notranslate"><span class="pre">application/json</span></code> come tipo di contenuto e DEVE includere i seguenti parametri:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: Il codice di errore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_description</span></code>: Testo in forma leggibile dall'uomo che fornisce ulteriori dettagli per chiarire la natura dell'errore incontrato.</p></li>
</ul>
<p>La seguente tabella elenca i Codici di Stato HTTP e i relativi codici di errore che DEVONO essere supportati per la risposta di errore:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Codice di Stato</strong></p></th>
<th class="head"><p><strong>Codice di Errore</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta perché l'Endpoint URI Request ha incontrato un problema interno. (<span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6749.html#section-4.1.2.1"><strong>RFC 6749#section-4.1.2.1</strong></a>).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta perché l'Endpoint URI Request è temporaneamente non disponibile (ad esempio, a causa di manutenzione o sovraccarico). (<span class="target" id="index-5"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6749.html#section-4.1.2.1"><strong>RFC 6749#section-4.1.2.1</strong></a>).</p></td>
</tr>
</tbody>
</table>
<p>Di seguito è riportato un esempio di risposta di errore dall'endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">500</span> <span class="ne">Internal Server Error</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;server_error&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Request Object cannot be retrieved due to an internal server error.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dopo aver ricevuto una risposta di errore, l'Istanza del Wallet DOVREBBE informare l'Utente della condizione di errore in modo appropriato. L'Istanza del Wallet DOVREBBE registrare l'errore e PUÒ tentare di recuperare da determinati errori se fattibile. Ad esempio, se l'errore è <code class="docutils literal notranslate"><span class="pre">server_error</span></code>, l'Istanza del Wallet DOVREBBE chiedere all'Utente di reinserire o scansionare un nuovo codice QR, se applicabile.</p>
</section>
</section>
<section id="risposta-di-autorizzazione">
<h2><span class="section-number">7.2.1.4. </span>Risposta di Autorizzazione<a class="headerlink" href="#risposta-di-autorizzazione" title="Link to this heading">¶</a></h2>
<p>Dopo aver ottenuto l'autorizzazione e il consenso dell'Utente per la presentazione delle Credenziali Elettroniche, l'Istanza del Wallet invia la Risposta di Autorizzazione all'endpoint <code class="docutils literal notranslate"><span class="pre">response_uri</span></code> della Relying Party utilizzando una richiesta HTTP con il metodo POST, il contenuto DOVREBBE essere crittografato secondo <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a> Sezione 7.3, utilizzando la chiave pubblica della Relying Party.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><strong>Perché la risposta è crittografata?</strong></p>
<p>La risposta inviata dall'Istanza del Wallet alla Relying Party è crittografata per impedire a un agente malevolo di accedere alle informazioni in chiaro trasmesse all'interno della rete della Relying Party. Questo è possibile solo se l'ambiente di rete della Relying Party impiega la <a class="reference external" href="https://www.f5.com/glossary/ssl-termination">terminazione TLS</a>. Tale tecnica impiega un proxy di terminazione che agisce come intermediario tra il client e il webserver e gestisce tutte le operazioni relative a TLS. In questo modo, il proxy decifra il contenuto della trasmissione e lo inoltra in chiaro o negozia una sessione TLS interna con il target previsto del webserver effettivo. Nel primo scenario, qualsiasi attore malevolo all'interno del segmento di rete potrebbe intercettare i dati trasmessi e ottenere informazioni sensibili, come una risposta non crittografata, sniffando i dati trasmessi.</p>
</div>
<p>Dove vengono utilizzati i seguenti parametri:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Nome</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>vp_token</strong></p></td>
<td><p>Ci DEVONO essere almeno due presentazioni firmate in questo Array:</p>
<ul class="simple">
<li><p>La Credenziale Elettronica richiesta (una o più, in formato SD-JWT VC)</p></li>
<li><p>L'Attestato di Wallet (in formato SD-JWT VC)</p></li>
</ul>
<p>Quando viene utilizzato <cite>presentation_definition</cite>, il valore <code class="docutils literal notranslate"><span class="pre">vp_token</span></code> è un Array JSON contenente la/e Presentazione/i Verificabile/i e il parametro <cite>presentation_submission</cite> DEVE essere presente anche all'interno della risposta.</p>
<p>Quando viene utilizzato il linguaggio di query DCQL, il formato <code class="docutils literal notranslate"><span class="pre">vp_token</span></code> è un Oggetto JSON le cui chiavi corrispondono agli id delle Credenziali richieste nel <code class="docutils literal notranslate"><span class="pre">dcql_query</span></code> utilizzato nella richiesta, e i valori a ciascuna Credenziale Elettronica presentata.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>state</strong></p></td>
<td><p>Identificatore univoco fornito dalla Relying Party all'interno della Richiesta di Autorizzazione.</p></td>
</tr>
</tbody>
</table>
<p>SD-JWT definisce come un Titolare può presentare una Credenziale Elettronica a una Relying Party, dimostrando il legittimo possesso della Credenziale Elettronica. Per fare ciò, il Titolare DEVE includere il <code class="docutils literal notranslate"><span class="pre">KB-JWT</span></code> nell'SD-JWT aggiungendo il <code class="docutils literal notranslate"><span class="pre">KB-JWT</span></code> alla fine dell'SD-JWT, come rappresentato nell'esempio seguente</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;Issuer-Signed-JWT&gt;~&lt;Disclosure 1&gt;~&lt;Disclosure 2&gt;~...~&lt;Disclosure N&gt;~&lt;KB-JWT&gt;
</pre></div>
</div>
<p>Per convalidare la firma sul Key Binding JWT, la Relying Party DEVE utilizzare il materiale chiave incluso nell'Issuer-Signed-JWT. La convalida della firma del Key Binding JWT (KB-JWT) DEVE utilizzare la chiave pubblica inclusa nell'SD-JWT, utilizzando il parametro <code class="docutils literal notranslate"><span class="pre">cnf</span></code> contenuto nell'Issuer-Signed-JWT.</p>
<p>Quando viene presentato un SD-JWT, il suo KB-JWT DEVE contenere i seguenti parametri nell'intestazione JWT:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Claim</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>typ</strong></p></td>
<td><p>OBBLIGATORIO. DEVE essere <code class="docutils literal notranslate"><span class="pre">kb+jwt</span></code>, che tipizza esplicitamente il Key Binding JWT come raccomandato nella Sezione 3.11 di [RFC8725].</p></td>
</tr>
<tr class="row-odd"><td><p><strong>alg</strong></p></td>
<td><p>OBBLIGATORIO. Algoritmo di Firma utilizzando uno di quelli specificati nella Sezione <a class="reference internal" href="algorithms.html#algoritmi-crittografici"><span class="std std-ref">Algoritmi Crittografici</span></a>.</p></td>
</tr>
</tbody>
</table>
<p>Quando viene presentato un SD-JWT, la firma KB-JWT DEVE essere verificata dalla stessa chiave pubblica inclusa nell'SD-JWT all'interno del parametro <cite>cnf</cite>. Il KB-JWT DEVE contenere i seguenti parametri nel payload JWT:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Claim</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>iat</strong></p></td>
<td><p>OBBLIGATORIO. Il valore di questo claim DEVE essere l'ora in cui è stato emesso il Key Binding JWT, utilizzando la sintassi definita in [RFC7519].</p></td>
</tr>
<tr class="row-odd"><td><p><strong>aud</strong></p></td>
<td><p>OBBLIGATORIO. Il ricevitore previsto del Key Binding JWT. Il valore di questo parametro DEVE corrispondere all'identificatore di entità univoco della Relying Party.</p></td>
</tr>
<tr class="row-even"><td><p><strong>nonce</strong></p></td>
<td><p>OBBLIGATORIO. Garantisce la freschezza della firma. Il tipo di valore di questo claim DEVE essere una stringa. Il valore DEVE corrispondere a quello fornito nell'oggetto di richiesta.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>sd_hash</strong></p></td>
<td><p>OBBLIGATORIO. Il digest hash codificato in base64url sul JWT firmato dall'Emittente e le divulgazioni selezionate.</p></td>
</tr>
</tbody>
</table>
<section id="errori-della-risposta-di-autorizzazione">
<h3><span class="section-number">7.2.1.4.1. </span>Errori della Risposta di Autorizzazione<a class="headerlink" href="#errori-della-risposta-di-autorizzazione" title="Link to this heading">¶</a></h3>
<p>Ci sono casi in cui l'Istanza del Wallet non può convalidare l'Oggetto di Richiesta o l'Oggetto di Richiesta risulta non valido. Questo errore si verifica se l'Oggetto di Richiesta viene recuperato con successo dall'url fornito nel parametro <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> ma non supera i controlli di convalida. Ciò potrebbe essere dovuto a firme errate, claim malformati o altri errori di convalida, come la revoca della Relying Party.</p>
<p>Se l'Istanza del Wallet incontra tali errori durante la valutazione della Richiesta di Autorizzazione, DEVE notificare alla Relying Party inviando una Risposta di Errore di Autorizzazione.
L'Istanza del Wallet invia la Risposta di Errore di Autorizzazione all'endpoint <code class="docutils literal notranslate"><span class="pre">response_uri</span></code> della Relying Party utilizzando una richiesta HTTP POST.
La Risposta di Errore di Autorizzazione DEVE essere codificata nel corpo della richiesta utilizzando il formato definito dal tipo di contenuto <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>.</p>
<p>Di seguito è riportato un esempio non normativo di una Risposta di Errore di Autorizzazione.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/response_uri</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">HOST</span><span class="o">:</span> <span class="l">relying-party.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

<span class="nt">state</span><span class="o">=</span><span class="s">3be39b69-6ac1-41aa-921b-3e6c07ddcb03</span><span class="p">&amp;</span>
<span class="nt">error</span><span class="o">=</span><span class="s">invalid_request</span><span class="p">&amp;</span>
<span class="nt">error_description</span><span class="o">=</span><span class="s">...</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Avvertimento</p>
<p>L'attuale specifica OpenID4VP delinea varie risposte di errore che un'Istanza del Wallet può restituire alla Relying Party (Verificatore) in caso di richieste errate. Per migliorare la privacy, le Istanze del Wallet NON DOVREBBERO notificare alla Relying Party le richieste errate in determinati scenari. Questo è per prevenire qualsiasi potenziale uso improprio delle risposte di errore che potrebbero portare a raccogliere informazioni che potrebbero essere sfruttate.</p>
</div>
<p>Nella seguente tabella sono elencati i codici di errore e le descrizioni che sono supportati per la Risposta di Errore di Autorizzazione:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Codice di Errore</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_request_object</span></code></p></td>
<td><p>L'Oggetto di Richiesta contiene parametri non validi o è altrimenti malformato. <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9101.html"><strong>RFC 9101</strong></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_request_uri</span></code></p></td>
<td><p>Il <cite>request_uri</cite> nella richiesta di autorizzazione restituisce un errore, contiene dati non validi o è altrimenti malformato. <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9101.html"><strong>RFC 9101</strong></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vp_formats_not_supported</span></code></p></td>
<td><p>L'Istanza del Wallet non supporta nessuno dei formati vp richiesti dalla Relying Party. <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>L'Istanza del Wallet non supporta nessuno degli algoritmi di firma richiesti dalla Relying Party. <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">access_denied</span></code></p></td>
<td><p>Il Wallet non aveva la Credenziale richiesta, l'Utente non ha dato il consenso o il Wallet non è riuscito ad autenticare l'Utente. <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_client</span></code></p></td>
<td><p>La Relying Party non può essere autorizzata a causa di errori di convalida della fiducia o non è un partecipante valido della federazione. <a class="reference external" href="https://openid.net/specs/openid-federation-1_0-41.html">OID-FED</a></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="risposta-della-relying-party">
<h2><span class="section-number">7.2.1.5. </span>Risposta della Relying Party<a class="headerlink" href="#risposta-della-relying-party" title="Link to this heading">¶</a></h2>
<p>Come definito nella Sezione 7.2. (Modalità di Risposta &quot;direct_post&quot;) della specifica <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-presentations-1_0-23.html">OpenID4VP</a>, se l'URI di Risposta ha elaborato con successo la Risposta di Autorizzazione o la Risposta di Errore di Autorizzazione, DEVE rispondere con un codice di stato HTTP 200 con <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> di <code class="docutils literal notranslate"><span class="pre">application/json</span></code> e un oggetto JSON nel corpo della risposta.</p>
<p>Nel <strong>Flusso Stesso Dispositivo</strong>, la Relying Party DOVREBBE aggiungere il parametro <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> all'oggetto JSON nel corpo della risposta. Dopo aver ricevuto il <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>, l'Istanza del Wallet DEVE eseguire un reindirizzamento all'URL specificato dal <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>.
Questo reindirizzamento consente alla Relying Party di riprendere senza problemi l'interazione con l'Utente sul dispositivo che ha avviato il flusso, dopo che l'Istanza del Wallet ha trasmesso la Risposta di Autorizzazione al <code class="docutils literal notranslate"><span class="pre">response_uri</span></code> designato.</p>
<p>La Relying Party DEVE includere un codice di risposta all'interno del <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code>. Il codice di risposta è un numero fresco, crittograficamente casuale utilizzato per garantire che solo il ricevitore del reindirizzamento possa recuperare ed elaborare la Risposta di Autorizzazione. Il numero potrebbe essere aggiunto come componente del percorso, come parametro o come frammento all'URL. È RACCOMANDATO utilizzare un valore casuale crittografico di 128 bit o più al momento della scrittura di questa specifica.
Anche se un avversario riesce a rubare il valore casuale utilizzato nella richiesta all'endpoint di stato, il suo user-agent verrebbe rifiutato a causa del cookie mancante nella richiesta.</p>
<div class="admonition warning">
<p class="admonition-title">Avvertimento</p>
<p>Per motivi di sicurezza e per prevenire attacchi di tipo endpoint mix-up, il valore contenuto nel parametro <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> DEVE essere uno di quelli attestati da una terza parte fidata, come quelli forniti nei metadati <code class="docutils literal notranslate"><span class="pre">openid_credential_verifier</span></code> all'interno del parametro <code class="docutils literal notranslate"><span class="pre">redirect_uris</span></code>, ottenuti dalla Catena di Fiducia relativa alla Relying Party.</p>
</div>
<section id="errori-della-risposta-della-relying-party">
<h3><span class="section-number">7.2.1.5.1. </span>Errori della Risposta della Relying Party<a class="headerlink" href="#errori-della-risposta-della-relying-party" title="Link to this heading">¶</a></h3>
<p>Se qualsiasi controllo di convalida, eseguito dalla Relying Party sulla Risposta di Autorizzazione dall'Istanza del Wallet, fallisce; l'endpoint URI di Risposta DEVE restituire una risposta di errore. La struttura di questa risposta di errore dovrebbe essere determinata dalla natura specifica dell'errore incontrato. La risposta DEVE utilizzare <code class="docutils literal notranslate"><span class="pre">application/json</span></code> come tipo di contenuto e DEVE includere i seguenti parametri:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: Il codice di errore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_description</span></code>: Testo in forma leggibile dall'uomo che fornisce ulteriori dettagli per chiarire la natura dell'errore incontrato.</p></li>
</ul>
<p>La seguente tabella elenca i Codici di Stato HTTP e i relativi codici di errore che DEVONO essere supportati per la risposta di errore:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Codice di Stato</strong></p></th>
<th class="head"><p><strong>Codice di Errore</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La risposta non può essere elaborata perché mancano parametri obbligatori, contiene parametri non validi o è altrimenti malformata.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>Le Credenziali presentate sono malformate, non valide o revocate.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La presentazione della Credenziale, contenuta nell'oggetto <code class="docutils literal notranslate"><span class="pre">vp_token</span></code>, è malformata, non ha i parametri richiesti o è formattata in modo errato.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>L'&quot;sd-jwt&quot; restituito è malformato, mancano parametri obbligatori o è formattato in modo errato.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La firma del KB-JWT non è valida o non corrisponde alla chiave pubblica associata (JWK) referenziata nell'SD-JWT firmato dall'Emittente.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>Il valore del nonce fornito è errato o altrimenti malformato.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La firma dell'Attestato di Wallet non è valida o la fiducia non può essere stabilita con il suo Emittente.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La fiducia non può essere stabilita con il Fornitore di Credenziale.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta perché l'Endpoint URI di Risposta ha incontrato un problema interno.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta perché l'Endpoint URI di Risposta è temporaneamente non disponibile (ad esempio, a causa di manutenzione o sovraccarico).</p></td>
</tr>
</tbody>
</table>
<p>Di seguito ci sono due esempi di risposte HTTP che utilizzano <code class="docutils literal notranslate"><span class="pre">application/json</span></code> che includono sia i membri <code class="docutils literal notranslate"><span class="pre">error</span></code> che <code class="docutils literal notranslate"><span class="pre">error_description</span></code>:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;invalid_request&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Trust cannot be established with the issuer: https://issuer.example.com&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;invalid_request&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The vp_token is malformed, missing required parameters or incorrectly formatted&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="endpoint-di-stato">
<h2><span class="section-number">7.2.1.6. </span>Endpoint di Stato<a class="headerlink" href="#endpoint-di-stato" title="Link to this heading">¶</a></h2>
<p>Questa specifica introduce l'Endpoint di Stato della Relying Party per le implementazioni che scelgono di utilizzarlo. Questo endpoint è una funzionalità di sicurezza interna dell'implementazione e non è richiesto per l'interoperabilità.</p>
<p>Sia che il flusso sia Stesso Dispositivo o Dispositivo Diverso, l'user-agent deve controllare lo stato della sessione all'endpoint reso disponibile dalla Relying Party (endpoint di stato).
Questo controllo PUÒ essere implementato sotto forma di codice JavaScript, all'interno della pagina che mostra il Codice QR o il pulsante href che punta all'URL di richiesta.
Il codice JavaScript fa sì che l'user-agent controlli l'endpoint di stato utilizzando una strategia di polling (in secondi) o una strategia push (ad esempio, WebSocket).</p>
<p>Poiché la pagina HTML e l'endpoint di stato sono implementati dalla Relying Party, i dettagli di implementazione di questa soluzione sono responsabilità della Relying Party, in quanto sono relativi all'API interna della Relying Party. Tuttavia, il testo seguente descrive un'implementazione di esempio.</p>
<p>La Relying Party lega la richiesta dell'user-agent, con un cookie di sessione contrassegnato come <code class="docutils literal notranslate"><span class="pre">Secure</span></code> e <code class="docutils literal notranslate"><span class="pre">HttpOnly</span></code>, con la richiesta emessa.
L'URL della richiesta DOVREBBE includere un parametro con un valore casuale. La risposta HTTP restituita da questo endpoint di stato PUÒ contenere i codici di stato HTTP elencati di seguito:</p>
<ul class="simple">
<li><p><strong>201 Created</strong>. L'Oggetto di Richiesta firmato è stato emesso dalla Relying Party che attende di essere scaricato dall'Istanza del Wallet all'endpoint <code class="docutils literal notranslate"><span class="pre">request_uri</span></code>.</p></li>
<li><p><strong>202 Accepted</strong>. Questa risposta viene data quando l'Oggetto di Richiesta firmato è stato ottenuto dall'Istanza del Wallet.</p></li>
<li><p><strong>200 OK</strong>. L'Istanza del Wallet ha fornito la presentazione all'endpoint <code class="docutils literal notranslate"><span class="pre">response_uri</span></code> della Relying Party e l'autenticazione dell'Utente ha avuto successo. La Relying Party aggiorna il cookie di sessione consentendo all'user-agent di accedere alla risorsa protetta. Viene fornito un URL di reindirizzamento che trasporta la posizione in cui l'user-agent deve navigare.</p></li>
</ul>
<section id="errori-dell-endpoint-di-stato">
<h3><span class="section-number">7.2.1.6.1. </span>Errori dell'Endpoint di Stato<a class="headerlink" href="#errori-dell-endpoint-di-stato" title="Link to this heading">¶</a></h3>
<p>Se invece qualsiasi controllo di convalida eseguito dalla Relying Party fallisce, la pagina del Codice QR DOVREBBE essere aggiornata con un messaggio di errore. Inoltre, l'endpoint di stato DEVE restituire una risposta di errore, la cui struttura dipende dalla natura dell'errore. La risposta DEVE utilizzare <code class="docutils literal notranslate"><span class="pre">application/json</span></code> come tipo di contenuto e DEVE includere i seguenti parametri:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: Il codice di errore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_description</span></code>: Testo in forma leggibile dall'uomo che fornisce ulteriori dettagli per chiarire la natura dell'errore incontrato.</p></li>
</ul>
<p>La seguente tabella elenca i Codici di Stato HTTP e i relativi codici di errore che DEVONO essere supportati per la risposta di errore:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Codice di Stato</strong></p></th>
<th class="head"><p><strong>Codice di Errore</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">Unauthorized</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">authentication_failed</span></code></p></td>
<td><p>L'Istanza del Wallet o il suo Utente hanno rifiutato la richiesta, la richiesta è scaduta o altri errori hanno impedito l'autenticazione.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_session</span></code></p></td>
<td><p>L'id di sessione fornito nella richiesta non è valido.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="uri-di-reindirizzamento">
<h2><span class="section-number">7.2.1.7. </span>URI di Reindirizzamento<a class="headerlink" href="#uri-di-reindirizzamento" title="Link to this heading">¶</a></h2>
<p>Il valore <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> DEVE essere utilizzato con un metodo HTTP GET dall'user-agent per reindirizzare l'Utente a un endpoint specifico della Relying Party al fine di completare il processo.</p>
<section id="errori-dell-uri-di-reindirizzamento">
<h3><span class="section-number">7.2.1.7.1. </span>Errori dell'URI di Reindirizzamento<a class="headerlink" href="#errori-dell-uri-di-reindirizzamento" title="Link to this heading">¶</a></h3>
<p>Quando l'user-agent viene reindirizzato all'URI di Reindirizzamento fornito dalla Relying Party, possono verificarsi diversi errori che impediscono il completamento con successo del processo. Questi errori sono critici in quanto influenzano direttamente l'esperienza dell'Utente ostacolando il flusso fluido di informazioni tra l'Istanza del Wallet e la Relying Party. La gestione di questi errori richiede una comunicazione chiara all'Utente all'interno della pagina web di navigazione restituita. La Relying Party DEVE implementare i meccanismi di gestione degli errori e di convalida per gli URI di Reindirizzamento definiti in questa specifica. Di seguito sono riportati potenziali errori relativi all'URI di Reindirizzamento, la risposta di errore DEVE utilizzare <code class="docutils literal notranslate"><span class="pre">application/json</span></code> come tipo di contenuto e DEVE includere i seguenti parametri:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: Il codice di errore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_description</span></code>: Testo in forma leggibile dall'uomo che fornisce ulteriori dettagli per chiarire la natura dell'errore incontrato.</p></li>
</ul>
</div></blockquote>
<p>La seguente tabella elenca i Codici di Stato HTTP e i relativi codici di errore che DEVONO essere supportati per la risposta di errore:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Codice di Stato</strong></p></th>
<th class="head"><p><strong>Codice di Errore</strong></p></th>
<th class="head"><p><strong>Descrizione</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>L'URI di Reindirizzamento fornito dalla Relying Party non corrisponde a nessuno degli URI collegati alla sessione dell'Utente. (<span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6749.html#section-4.1.2.1"><strong>RFC 6749#section-4.1.2.1</strong></a>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">403</span> <span class="pre">Forbidden</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">invalid_request</span></code></p></td>
<td><p>La sessione dell'Utente non è valida o è scaduta.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_error</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta a causa di un errore interno del server. (<span class="target" id="index-9"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6749.html#section-4.1.2.1"><strong>RFC 6749#section-4.1.2.1</strong></a>).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">temporarily_unavailable</span></code></p></td>
<td><p>La richiesta non può essere soddisfatta perché il servizio è temporaneamente non disponibile (ad esempio, a causa di manutenzione o sovraccarico). (<span class="target" id="index-10"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6749.html#section-4.1.2.1"><strong>RFC 6749#section-4.1.2.1</strong></a>).</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">7.2.1. Flusso Remoto</a><ul>
<li><a class="reference internal" href="#richiesta-di-autorizzazione">7.2.1.1. Richiesta di Autorizzazione</a></li>
<li><a class="reference internal" href="#richiesta-uri-request">7.2.1.2. Richiesta URI Request</a></li>
<li><a class="reference internal" href="#risposta-uri-request">7.2.1.3. Risposta URI Request</a><ul>
<li><a class="reference internal" href="#errori-dell-endpoint-uri-request">7.2.1.3.1. Errori dell'Endpoint URI Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#risposta-di-autorizzazione">7.2.1.4. Risposta di Autorizzazione</a><ul>
<li><a class="reference internal" href="#errori-della-risposta-di-autorizzazione">7.2.1.4.1. Errori della Risposta di Autorizzazione</a></li>
</ul>
</li>
<li><a class="reference internal" href="#risposta-della-relying-party">7.2.1.5. Risposta della Relying Party</a><ul>
<li><a class="reference internal" href="#errori-della-risposta-della-relying-party">7.2.1.5.1. Errori della Risposta della Relying Party</a></li>
</ul>
</li>
<li><a class="reference internal" href="#endpoint-di-stato">7.2.1.6. Endpoint di Stato</a><ul>
<li><a class="reference internal" href="#errori-dell-endpoint-di-stato">7.2.1.6.1. Errori dell'Endpoint di Stato</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uri-di-reindirizzamento">7.2.1.7. URI di Reindirizzamento</a><ul>
<li><a class="reference internal" href="#errori-dell-uri-di-reindirizzamento">7.2.1.7.1. Errori dell'URI di Reindirizzamento</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="credential-presentation.html">
                    <span class="icon">&lt;</span><span><span class="section-number">7.2. </span>Presentazione della Credenziale Digitale</span></a>
                
            </div>

            <div class="right">
                
                    <a href="proximity-flow.html"><span><span class="section-number">7.2.2. </span>Flusso di Prossimità</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
      Ultimo aggiornamento 30/05/2025.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.5.
    </div>

<p id="theme_credit"></p>
  </body>
</html>